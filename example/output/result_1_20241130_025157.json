{
    "question_answer": "### 问题\n\n如何在 Apache Flink 中为内部和外部连接分别设置 SSL/TLS 认证和加密，并确保不同连接类型的安全性？\n\n### 答案\n\n在 Apache Flink 中，为内部和外部连接分别设置 SSL/TLS 认证和加密涉及多个步骤，需要遵循不同的配置流程，以确保各连接类型的安全性。\n\n#### 内部连接\n\n内部连接指的是在 Flink 进程之间的通信，包括：\n\n- JobManager、TaskManager、Dispatcher 和 ResourceManager 之间的控制消息（RPC）。\n- TaskManagers 之间的数据传输。\n- Blob 服务用于分发库和其他工件。\n\n1. **启用内部连接的 SSL：**\n\n   首先，需要在 `flink-conf.yaml` 文件中启用内部连接的 SSL 配置：\n\n   ```yaml\n   security.ssl.internal.enabled: true\n   ```\n\n2. **密钥库和信任库配置：**\n\n   内部通信通常使用相同的密钥库和信任库，这些库包含一个专用的证书，作为共享的秘密。可以使用自签名证书来简化设置：\n\n   ```yaml\n   security.ssl.internal.keystore: /path/to/internal.keystore\n   security.ssl.internal.keystore-password: internal_store_password\n   security.ssl.internal.key-password: internal_store_password\n   security.ssl.internal.truststore: /path/to/internal.keystore\n   security.ssl.internal.truststore-password: internal_store_password\n   ```\n\n   若证书不是自签名的，而是由 CA 签署，则需要使用证书固定（certificate pinning）来确保仅信任特定证书：\n\n   ```yaml\n   security.ssl.internal.cert.fingerprint: 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00\n   ```\n\n3. **连接类型的选择性禁用：**\n\n   可以选择性地为不同的内部连接类型禁用 SSL：\n\n   ```yaml\n   taskmanager.data.ssl.enabled: false  # 禁用 TaskManagers 之间的数据通信 SSL\n   blob.service.ssl.enabled: false      # 禁用 Blob 服务的 SSL\n   pekko.ssl.enabled: false             # 禁用基于 Pekko 的 RPC 连接 SSL\n   ```\n\n#### 外部/REST 连接\n\n外部连接包括与 Flink 进程的 HTTP/REST 接口的通信，例如通过 Web UI 和 CLI 与 Dispatcher 和 JobMaster 交互。\n\n1. **启用 REST 连接的 SSL：**\n\n   在 `flink-conf.yaml` 文件中启用 REST 连接的 SSL 配置：\n\n   ```yaml\n   security.ssl.rest.enabled: true\n   ```\n\n2. **密钥库和信任库配置：**\n\n   REST 端点通常使用由 CA 签署的正式证书。在简单情况下，可以使用自签名证书：\n\n   ```yaml\n   security.ssl.rest.keystore: /path/to/rest.keystore\n   security.ssl.rest.keystore-password: rest_keystore_password\n   security.ssl.rest.truststore: /path/to/rest.truststore\n   security.ssl.rest.truststore-password: rest_truststore_password\n   ```\n\n3. **使用代理进行认证：**\n\n   REST 端点不默认进行客户端认证，建议使用代理（如 Envoy 或 NGINX）来处理认证：\n\n   - 将 REST 端点绑定到回环接口。\n   - 启动一个 REST 代理来认证并转发请求。\n\n4. **启用简单的相互认证：**\n\n   如果需要，可以通过配置启用简单的相互认证：\n\n   ```yaml\n   security.ssl.rest.authentication-enabled: true\n   ```\n\n通过以上步骤，可以分别为内部和外部连接在 Apache Flink 中设置 SSL/TLS 认证和加密，确保不同连接类型的安全性。",
    "documents": [
        "deployment/security/security-ssl.md"
    ],
    "timestamp": "2024-11-30T02:51:57.616691"
}